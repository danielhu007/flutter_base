<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>plus.android æµ‹è¯•</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; margin: 0; padding: 16px; background: #f8f8f8; }
    button { display: block; width: 100%; max-width: 320px; margin: 12px auto; padding: 16px 0; font-size: 18px; border-radius: 8px; border: none; background: #3DDC84; color: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.04); cursor: pointer; transition: background 0.2s; }
    button:active { background: #2FB868; }
    .result { background: #fff; padding: 12px; margin: 12px auto; max-width: 320px; border-radius: 8px; border-left: 4px solid #3DDC84; word-break: break-all; }
    .error { background: #fff; padding: 12px; margin: 12px auto; max-width: 320px; border-radius: 8px; border-left: 4px solid #FF4444; word-break: break-all; color: #FF4444; }
    .info { background: #fff; padding: 12px; margin: 12px auto; max-width: 320px; border-radius: 8px; border-left: 4px solid #2196F3; word-break: break-all; color: #2196F3; }
  </style>
</head>
<body>
  <h1>plus.android æµ‹è¯•</h1>
  <button onclick="testImportClass()">æµ‹è¯• importClass</button>
  <button onclick="testNewObject()">æµ‹è¯• newObject</button>
  <button onclick="testInvoke()">æµ‹è¯• invoke</button>
  <button onclick="testGetAttribute()">æµ‹è¯• getAttribute</button>
  <button onclick="testSetAttribute()">æµ‹è¯• setAttribute</button>
  <button onclick="testRuntimeMainActivity()">æµ‹è¯• runtimeMainActivity</button>
  <button onclick="testCurrentWebview()">æµ‹è¯• currentWebview</button>
  <button onclick="testRequestPermissions()">æµ‹è¯• requestPermissions</button>
  <button onclick="testAutoCollection()">æµ‹è¯• autoCollection</button>
  <button onclick="testGetAvailMem()">æµ‹è¯• getAvailMem</button>
  <button onclick="testGetAvailMemExample()">æµ‹è¯•è·å–å¯ç”¨å†…å­˜ç¤ºä¾‹</button>
  
  <div id="results"></div>
  
  <script>
    let plusReady = false;
    
    function checkPlusReady() {
      if (!plusReady) {
        alert('Plusç¯å¢ƒæœªå°±ç»ªï¼Œè¯·ç­‰å¾…é¡µé¢å®Œå…¨åŠ è½½');
        return false;
      }
      return true;
    }
    
    function addResult(content, isError = false, isInfo = false) {
      const resultsDiv = document.getElementById('results');
      const div = document.createElement('div');
      if (isError) {
        div.className = 'error';
      } else if (isInfo) {
        div.className = 'info';
      } else {
        div.className = 'result';
      }
      div.textContent = content;
      resultsDiv.appendChild(div);
    }
    
    function testImportClass() {
      if (!checkPlusReady()) return;
      try {
        plus.android.importClass("android.content.Context")
          .then(function(result) {
            addResult('importClass æˆåŠŸ: ' + JSON.stringify(result));
          })
          .catch(function(error) {
            addResult('importClass å¤±è´¥: ' + error.message, true);
          });
      } catch (e) {
        addResult('è°ƒç”¨ importClass å¤±è´¥: ' + e.message, true);
      }
    }
    
    function testNewObject() {
      if (!checkPlusReady()) return;
      try {
        plus.android.newObject("android.app.ActivityManager\$MemoryInfo")
          .then(function(result) {
            addResult('newObject æˆåŠŸ: ' + JSON.stringify(result));
          })
          .catch(function(error) {
            addResult('newObject å¤±è´¥: ' + error.message, true);
          });
      } catch (e) {
        addResult('è°ƒç”¨ newObject å¤±è´¥: ' + e.message, true);
      }
    }
    
    function testInvoke() {
      if (!checkPlusReady()) return;
      try {
        const obj = { className: "test" };
        plus.android.invoke(obj, "testMethod", "arg1", "arg2")
          .then(function(result) {
            addResult('invoke æˆåŠŸ: ' + JSON.stringify(result));
          })
          .catch(function(error) {
            addResult('invoke å¤±è´¥: ' + error.message, true);
          });
      } catch (e) {
        addResult('è°ƒç”¨ invoke å¤±è´¥: ' + e.message, true);
      }
    }
    
    function testGetAttribute() {
      if (!checkPlusReady()) return;
      try {
        const obj = { className: "test", fieldName: "testField" };
        plus.android.getAttribute(obj, "testField")
          .then(function(result) {
            addResult('getAttribute æˆåŠŸ: ' + JSON.stringify(result));
          })
          .catch(function(error) {
            addResult('getAttribute å¤±è´¥: ' + error.message, true);
          });
      } catch (e) {
        addResult('è°ƒç”¨ getAttribute å¤±è´¥: ' + e.message, true);
      }
    }
    
    function testSetAttribute() {
      if (!checkPlusReady()) return;
      try {
        const obj = { className: "test" };
        plus.android.setAttribute(obj, "testField", "testValue")
          .then(function(result) {
            addResult('setAttribute æˆåŠŸ: ' + JSON.stringify(result));
          })
          .catch(function(error) {
            addResult('setAttribute å¤±è´¥: ' + error.message, true);
          });
      } catch (e) {
        addResult('è°ƒç”¨ setAttribute å¤±è´¥: ' + e.message, true);
      }
    }
    
    function testRuntimeMainActivity() {
      if (!checkPlusReady()) return;
      try {
        plus.android.runtimeMainActivity()
          .then(function(result) {
            addResult('runtimeMainActivity æˆåŠŸ: ' + result);
          })
          .catch(function(error) {
            addResult('runtimeMainActivity å¤±è´¥: ' + error.message, true);
          });
      } catch (e) {
        addResult('è°ƒç”¨ runtimeMainActivity å¤±è´¥: ' + e.message, true);
      }
    }
    
    function testCurrentWebview() {
      if (!checkPlusReady()) return;
      try {
        plus.android.currentWebview()
          .then(function(result) {
            addResult('currentWebview æˆåŠŸ: ' + result);
          })
          .catch(function(error) {
            addResult('currentWebview å¤±è´¥: ' + error.message, true);
          });
      } catch (e) {
        addResult('è°ƒç”¨ currentWebview å¤±è´¥: ' + e.message, true);
      }
    }
    
    function testRequestPermissions() {
      if (!checkPlusReady()) return;
      try {
        plus.android.requestPermissions(["android.permission.CAMERA", "android.permission.READ_EXTERNAL_STORAGE"], function(granted) {
          addResult('requestPermissions ç»“æœ: ' + (granted ? 'å·²æˆæƒ' : 'æœªæˆæƒ'), false, true);
        });
      } catch (e) {
        addResult('è°ƒç”¨ requestPermissions å¤±è´¥: ' + e.message, true);
      }
    }
    
    function testAutoCollection() {
      if (!checkPlusReady()) return;
      try {
        const instance = { className: "test" };
        plus.android.autoCollection(instance)
          .then(function(result) {
            addResult('autoCollection æˆåŠŸ: ' + JSON.stringify(result));
          })
          .catch(function(error) {
            addResult('autoCollection å¤±è´¥: ' + error.message, true);
          });
      } catch (e) {
        addResult('è°ƒç”¨ autoCollection å¤±è´¥: ' + e.message, true);
      }
    }
    
    function testGetAvailMem() {
      if (!checkPlusReady()) return;
      try {
        plus.android.getAvailMem()
          .then(function(result) {
            addResult('getAvailMem æˆåŠŸ: ' + result + ' bytes');
          })
          .catch(function(error) {
            addResult('getAvailMem å¤±è´¥: ' + error.message, true);
          });
      } catch (e) {
        addResult('è°ƒç”¨ getAvailMem å¤±è´¥: ' + e.message, true);
      }
    }
    
    function testGetAvailMemExample() {
      if (!checkPlusReady()) return;
      try {
        // ä½¿ç”¨å…¨å±€å‡½æ•° getAvailMem
        if (typeof window.getAvailMem === 'function') {
          window.getAvailMem()
            .then(function(result) {
              addResult('è·å–å¯ç”¨å†…å­˜ç¤ºä¾‹æˆåŠŸ: ' + result + ' bytes (' + (result / 1024 / 1024).toFixed(2) + ' MB)', false, true);
            })
            .catch(function(error) {
              addResult('è·å–å¯ç”¨å†…å­˜ç¤ºä¾‹å¤±è´¥: ' + error.message, true);
            });
        } else {
          addResult('getAvailMem å‡½æ•°æœªå®šä¹‰', true);
        }
      } catch (e) {
        addResult('è°ƒç”¨è·å–å¯ç”¨å†…å­˜ç¤ºä¾‹å¤±è´¥: ' + e.message, true);
      }
    }
    
    // ç­‰å¾…plusreadyäº‹ä»¶
    document.addEventListener('plusready', function() {
      console.log('Plusç¯å¢ƒå·²å°±ç»ª');
      plusReady = true;
      
      // æ˜¾ç¤ºplusç¯å¢ƒçŠ¶æ€
      const statusDiv = document.createElement('div');
      statusDiv.style.cssText = 'background: #3DDC84; color: white; padding: 10px; margin: 10px 0; border-radius: 4px;';
      statusDiv.innerHTML = 'âœ… Plusç¯å¢ƒå·²å°±ç»ª';
      document.body.insertBefore(statusDiv, document.getElementById('results'));
      
      // æ˜¾ç¤ºå¹³å°ä¿¡æ¯
      setTimeout(function() {
        const infoDiv = document.createElement('div');
        infoDiv.style.cssText = 'background: #2196F3; color: white; padding: 10px; margin: 10px 0; border-radius: 4px; font-family: monospace;';
        
        try {
          const platformInfo = {
            os: plus.os.name,
            version: plus.os.version,
            isAndroid: plus.os.name === 'Android'
          };
          infoDiv.innerHTML = 'ğŸ“± å¹³å°ä¿¡æ¯: ' + JSON.stringify(platformInfo, null, 2);
        } catch (e) {
          infoDiv.innerHTML = 'âŒ è·å–å¹³å°ä¿¡æ¯å¤±è´¥: ' + e.message;
        }
        
        document.body.insertBefore(infoDiv, document.getElementById('results'));
      }, 500);
    });
    
    // å¦‚æœpluså·²ç»å­˜åœ¨ï¼Œç›´æ¥æ ‡è®°ä¸ºå°±ç»ª
    if (window.plus) {
      plusReady = true;
      document.addEventListener('DOMContentLoaded', function() {
        const statusDiv = document.createElement('div');
        statusDiv.style.cssText = 'background: #3DDC84; color: white; padding: 10px; margin: 10px 0; border-radius: 4px;';
        statusDiv.innerHTML = 'âœ… Plusç¯å¢ƒå·²å°±ç»ª (é¢„åŠ è½½)';
        document.body.insertBefore(statusDiv, document.getElementById('results'));
      });
    }
    
    // é¡µé¢åŠ è½½å®Œæˆåæ£€æŸ¥plusç¯å¢ƒ
    window.addEventListener('load', function() {
      console.log('é¡µé¢åŠ è½½å®Œæˆ');
      setTimeout(function() {
        if (!plusReady && !window.plus) {
          const errorDiv = document.createElement('div');
          errorDiv.style.cssText = 'background: #f44336; color: white; padding: 10px; margin: 10px 0; border-radius: 4px;';
          errorDiv.innerHTML = 'âŒ Plusç¯å¢ƒæœªåŠ è½½ï¼Œè¯·æ£€æŸ¥WebViewé…ç½®';
          document.body.insertBefore(errorDiv, document.getElementById('results'));
        }
      }, 2000);
    });
  </script>
</body>
</html>