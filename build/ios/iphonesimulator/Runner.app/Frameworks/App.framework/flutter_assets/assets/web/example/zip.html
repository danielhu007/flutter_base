<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plus.zip å‹ç¼©åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            line-height: 1.6;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fafafa;
        }
        .section h2 {
            color: #555;
            margin-top: 0;
        }
        button {
            background-color: #007cba;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background-color: #005a87;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        input[type="text"], input[type="number"], select {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .input-group {
            margin-bottom: 15px;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        .result {
            background-color: #f0f8f0;
            border: 1px solid #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .error {
            background-color: #f8f0f0;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .loading {
            display: none;
            text-align: center;
            color: #666;
        }
        .loading.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Plus.zip å‹ç¼©åŠŸèƒ½æµ‹è¯•</h1>
        
        <!-- æ–‡ä»¶å‹ç¼©æµ‹è¯• -->
        <div class="section">
            <h2>ğŸ“ æ–‡ä»¶/ç›®å½•å‹ç¼©</h2>
            <div class="input-group">
                <label for="compressSrc">æºæ–‡ä»¶æˆ–ç›®å½•è·¯å¾„:</label>
                <input type="text" id="compressSrc" placeholder="ä¾‹: _doc/test.txt æˆ– _www/images/" value="_doc/test/">
                <small style="color: #666; font-size: 12px;">
                    æ³¨æ„ï¼š_www/ å’Œ _doc/ æŒ‡å‘åº”ç”¨æ–‡æ¡£ç›®å½•ï¼Œè¯·å…ˆåˆ›å»ºæµ‹è¯•æ–‡ä»¶
                </small>
            </div>
            <div class="input-group">
                <label for="compressZip">ç›®æ ‡ZIPæ–‡ä»¶è·¯å¾„:</label>
                <input type="text" id="compressZip" placeholder="ä¾‹: _doc/archive.zip" value="_doc/test_archive.zip">
            </div>
            <button onclick="testCompress()">å‹ç¼©æ–‡ä»¶</button>
            <div class="loading" id="compressLoading">å‹ç¼©ä¸­ï¼Œè¯·ç¨å€™...</div>
            <div class="result" id="compressResult"></div>
        </div>

        <!-- æ–‡ä»¶è§£å‹æµ‹è¯• -->
        <div class="section">
            <h2>ğŸ“‚ ZIPæ–‡ä»¶è§£å‹</h2>
            <div class="input-group">
                <label for="decompressZip">ZIPæ–‡ä»¶è·¯å¾„:</label>
                <input type="text" id="decompressZip" placeholder="ä¾‹: _doc/archive.zip" value="_doc/test_archive.zip">
            </div>
            <div class="input-group">
                <label for="decompressTarget">è§£å‹ç›®æ ‡ç›®å½•:</label>
                <input type="text" id="decompressTarget" placeholder="ä¾‹: _doc/extracted/" value="_doc/extracted/">
            </div>
            <button onclick="testDecompress()">è§£å‹æ–‡ä»¶</button>
            <div class="loading" id="decompressLoading">è§£å‹ä¸­ï¼Œè¯·ç¨å€™...</div>
            <div class="result" id="decompressResult"></div>
        </div>

        <!-- å›¾ç‰‡å‹ç¼©æµ‹è¯• -->
        <div class="section">
            <h2>ğŸ–¼ï¸ å›¾ç‰‡å‹ç¼©</h2>
            <div class="input-group">
                <label for="imageSrc">æºå›¾ç‰‡è·¯å¾„:</label>
                <input type="text" id="imageSrc" placeholder="ä¾‹: _www/image.jpg" value="_www/test_image.jpg">
            </div>
            <div class="input-group">
                <label for="imageDst">ç›®æ ‡å›¾ç‰‡è·¯å¾„:</label>
                <input type="text" id="imageDst" placeholder="ä¾‹: _doc/compressed.jpg" value="_doc/compressed.jpg">
            </div>
            <div class="input-group">
                <label for="imageFormat">æ ¼å¼:</label>
                <select id="imageFormat">
                    <option value="jpg">JPG</option>
                    <option value="png">PNG</option>
                </select>
            </div>
            <div class="input-group">
                <label for="imageQuality">è´¨é‡ (1-100):</label>
                <input type="number" id="imageQuality" min="1" max="100" value="70">
            </div>
            <div class="input-group">
                <label for="imageWidth">å®½åº¦:</label>
                <input type="text" id="imageWidth" placeholder="ä¾‹: 500px, 50%, auto" value="50%">
            </div>
            <div class="input-group">
                <label for="imageHeight">é«˜åº¦:</label>
                <input type="text" id="imageHeight" placeholder="ä¾‹: 400px, 60%, auto" value="auto">
            </div>
            <div class="input-group">
                <label for="imageRotate">æ—‹è½¬è§’åº¦:</label>
                <select id="imageRotate">
                    <option value="0">ä¸æ—‹è½¬</option>
                    <option value="90">90åº¦</option>
                    <option value="180">180åº¦</option>
                    <option value="270">270åº¦</option>
                </select>
            </div>
            <div class="input-group">
                <label>
                    <input type="checkbox" id="imageOverwrite" checked> è¦†ç›–åŒåæ–‡ä»¶
                </label>
            </div>
            <button onclick="testCompressImage()">å‹ç¼©å›¾ç‰‡</button>
            <div class="loading" id="imageLoading">å›¾ç‰‡å‹ç¼©ä¸­ï¼Œè¯·ç¨å€™...</div>
            <div class="result" id="imageResult"></div>
        </div>

        <!-- è§†é¢‘å‹ç¼©æµ‹è¯• -->
        <div class="section">
            <h2>ğŸ¥ è§†é¢‘å‹ç¼©</h2>
            <div class="input-group">
                <label for="videoSrc">æºè§†é¢‘è·¯å¾„:</label>
                <input type="text" id="videoSrc" placeholder="ä¾‹: _www/video.mp4" value="_www/test_video.mp4">
            </div>
            <div class="input-group">
                <label for="videoQuality">å‹ç¼©è´¨é‡:</label>
                <select id="videoQuality">
                    <option value="low">ä½è´¨é‡</option>
                    <option value="medium">ä¸­ç­‰è´¨é‡</option>
                    <option value="high" selected>é«˜è´¨é‡</option>
                </select>
            </div>
            <div class="input-group">
                <label for="videoFilename">è‡ªå®šä¹‰è¾“å‡ºè·¯å¾„ (å¯é€‰):</label>
                <input type="text" id="videoFilename" placeholder="ä¾‹: _doc/compressed_video.mp4">
            </div>
            <button onclick="testCompressVideo()">å‹ç¼©è§†é¢‘</button>
            <div class="loading" id="videoLoading">è§†é¢‘å‹ç¼©ä¸­ï¼Œè¯·ç¨å€™...</div>
            <div class="result" id="videoResult"></div>
        </div>

        <!-- æµ‹è¯•æ–‡ä»¶å‡†å¤‡ -->
        <div class="section">
            <h2>ğŸ“ æµ‹è¯•æ–‡ä»¶å‡†å¤‡</h2>
            <p>ä¸ºäº†æµ‹è¯•å‹ç¼©åŠŸèƒ½ï¼Œé¦–å…ˆéœ€è¦åˆ›å»ºä¸€äº›æµ‹è¯•æ–‡ä»¶ã€‚</p>
            <button onclick="createTestFiles()">åˆ›å»ºæµ‹è¯•æ–‡ä»¶</button>
            <div class="loading" id="createFilesLoading">æ­£åœ¨åˆ›å»ºæµ‹è¯•æ–‡ä»¶...</div>
            <div class="result" id="createFilesResult"></div>
        </div>

        <!-- ç»¼åˆæµ‹è¯• -->
        <div class="section">
            <h2>ğŸ§ª ç»¼åˆæµ‹è¯•</h2>
            <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®æ‰§è¡Œä¸€ç³»åˆ—å®Œæ•´çš„å‹ç¼©å’Œè§£å‹æµ‹è¯•ã€‚</p>
            <button onclick="runFullTest()">è¿è¡Œå®Œæ•´æµ‹è¯•</button>
            <div class="loading" id="fullTestLoading">æ­£åœ¨è¿è¡Œå®Œæ•´æµ‹è¯•...</div>
            <div class="result" id="fullTestResult"></div>
        </div>
    </div>

    <script>
        // ç­‰å¾… plus å¯¹è±¡å‡†å¤‡å®Œæˆ
        document.addEventListener('plusready', function() {
            console.log('Plus.zip æ¨¡å—å·²å‡†å¤‡å°±ç»ª');
            showResult('é¡µé¢å·²åŠ è½½ï¼ŒPlus.zip æ¨¡å—å‡†å¤‡å°±ç»ªï¼', 'compressResult');
        });

        // æ˜¾ç¤ºç»“æœ
        function showResult(message, elementId, isError = false) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = isError ? 'result error' : 'result';
        }

        // æ˜¾ç¤º/éšè—åŠ è½½çŠ¶æ€
        function showLoading(elementId, show = true) {
            const element = document.getElementById(elementId);
            if (show) {
                element.classList.add('show');
            } else {
                element.classList.remove('show');
            }
        }

        // æ–‡ä»¶å‹ç¼©æµ‹è¯•
        function testCompress() {
            const src = document.getElementById('compressSrc').value;
            const zipfile = document.getElementById('compressZip').value;
            
            if (!src || !zipfile) {
                showResult('è¯·å¡«å†™æºè·¯å¾„å’Œç›®æ ‡ZIPæ–‡ä»¶è·¯å¾„', 'compressResult', true);
                return;
            }

            showLoading('compressLoading', true);
            showResult('å¼€å§‹å‹ç¼©...', 'compressResult');

            plus.zip.compress(
                src,
                zipfile,
                function() {
                    showLoading('compressLoading', false);
                    showResult(`âœ… å‹ç¼©æˆåŠŸï¼
æºè·¯å¾„: ${src}
ZIPæ–‡ä»¶: ${zipfile}
å®Œæˆæ—¶é—´: ${new Date().toLocaleString()}`, 'compressResult');
                },
                function(error) {
                    showLoading('compressLoading', false);
                    showResult(`âŒ å‹ç¼©å¤±è´¥ï¼
é”™è¯¯ä»£ç : ${error.code}
é”™è¯¯ä¿¡æ¯: ${error.message}`, 'compressResult', true);
                }
            );
        }

        // æ–‡ä»¶è§£å‹æµ‹è¯•
        function testDecompress() {
            const zipfile = document.getElementById('decompressZip').value;
            const target = document.getElementById('decompressTarget').value;
            
            if (!zipfile || !target) {
                showResult('è¯·å¡«å†™ZIPæ–‡ä»¶è·¯å¾„å’Œè§£å‹ç›®æ ‡ç›®å½•', 'decompressResult', true);
                return;
            }

            showLoading('decompressLoading', true);
            showResult('å¼€å§‹è§£å‹...', 'decompressResult');

            plus.zip.decompress(
                zipfile,
                target,
                function() {
                    showLoading('decompressLoading', false);
                    showResult(`âœ… è§£å‹æˆåŠŸï¼
ZIPæ–‡ä»¶: ${zipfile}
ç›®æ ‡ç›®å½•: ${target}
å®Œæˆæ—¶é—´: ${new Date().toLocaleString()}`, 'decompressResult');
                },
                function(error) {
                    showLoading('decompressLoading', false);
                    showResult(`âŒ è§£å‹å¤±è´¥ï¼
é”™è¯¯ä»£ç : ${error.code}
é”™è¯¯ä¿¡æ¯: ${error.message}`, 'decompressResult', true);
                }
            );
        }

        // å›¾ç‰‡å‹ç¼©æµ‹è¯•
        function testCompressImage() {
            const options = {
                src: document.getElementById('imageSrc').value,
                dst: document.getElementById('imageDst').value,
                format: document.getElementById('imageFormat').value,
                quality: parseInt(document.getElementById('imageQuality').value),
                width: document.getElementById('imageWidth').value,
                height: document.getElementById('imageHeight').value,
                rotate: parseInt(document.getElementById('imageRotate').value),
                overwrite: document.getElementById('imageOverwrite').checked
            };
            
            if (!options.src || !options.dst) {
                showResult('è¯·å¡«å†™æºå›¾ç‰‡è·¯å¾„å’Œç›®æ ‡å›¾ç‰‡è·¯å¾„', 'imageResult', true);
                return;
            }

            showLoading('imageLoading', true);
            showResult('å¼€å§‹å‹ç¼©å›¾ç‰‡...', 'imageResult');

            plus.zip.compressImage(
                options,
                function(result) {
                    showLoading('imageLoading', false);
                    showResult(`âœ… å›¾ç‰‡å‹ç¼©æˆåŠŸï¼
æºå›¾ç‰‡: ${options.src}
å‹ç¼©å: ${result.target}
æ–‡ä»¶å¤§å°: ${(result.size / 1024).toFixed(2)} KB
å›¾ç‰‡å°ºå¯¸: ${result.width} x ${result.height}
å®Œæˆæ—¶é—´: ${new Date().toLocaleString()}`, 'imageResult');
                },
                function(error) {
                    showLoading('imageLoading', false);
                    showResult(`âŒ å›¾ç‰‡å‹ç¼©å¤±è´¥ï¼
é”™è¯¯ä»£ç : ${error.code}
é”™è¯¯ä¿¡æ¯: ${error.message}`, 'imageResult', true);
                }
            );
        }

        // è§†é¢‘å‹ç¼©æµ‹è¯•
        function testCompressVideo() {
            const options = {
                src: document.getElementById('videoSrc').value,
                quality: document.getElementById('videoQuality').value
            };

            const customFilename = document.getElementById('videoFilename').value;
            if (customFilename) {
                options.filename = customFilename;
            }
            
            if (!options.src) {
                showResult('è¯·å¡«å†™æºè§†é¢‘è·¯å¾„', 'videoResult', true);
                return;
            }

            showLoading('videoLoading', true);
            showResult('å¼€å§‹å‹ç¼©è§†é¢‘...', 'videoResult');

            plus.zip.compressVideo(
                options,
                function(result) {
                    showLoading('videoLoading', false);
                    showResult(`âœ… è§†é¢‘å‹ç¼©æˆåŠŸï¼
æºè§†é¢‘: ${options.src}
å‹ç¼©å: ${result.tempFilePath}
æ–‡ä»¶å¤§å°: ${(result.size / 1024 / 1024).toFixed(2)} MB
è´¨é‡è®¾ç½®: ${options.quality}
å®Œæˆæ—¶é—´: ${new Date().toLocaleString()}`, 'videoResult');
                },
                function(error) {
                    showLoading('videoLoading', false);
                    showResult(`âŒ è§†é¢‘å‹ç¼©å¤±è´¥ï¼
é”™è¯¯ä»£ç : ${error.code}
é”™è¯¯ä¿¡æ¯: ${error.message}`, 'videoResult', true);
                }
            );
        }

        // å®Œæ•´æµ‹è¯•
        function runFullTest() {
            showLoading('fullTestLoading', true);
            showResult('å¼€å§‹è¿è¡Œå®Œæ•´æµ‹è¯•...\n', 'fullTestResult');
            
            let testResults = [];
            let currentTest = 0;
            const tests = [
                { name: 'æ–‡ä»¶å‹ç¼©æµ‹è¯•', func: runCompressTest },
                { name: 'æ–‡ä»¶è§£å‹æµ‹è¯•', func: runDecompressTest },
                { name: 'å›¾ç‰‡å‹ç¼©æµ‹è¯•', func: runImageTest },
                { name: 'è§†é¢‘å‹ç¼©æµ‹è¯•', func: runVideoTest }
            ];

            function runNextTest() {
                if (currentTest >= tests.length) {
                    showLoading('fullTestLoading', false);
                    showResult(`ğŸ‰ å®Œæ•´æµ‹è¯•å®Œæˆï¼

æµ‹è¯•ç»“æœæ±‡æ€»:
${testResults.join('\n')}

æ€»æµ‹è¯•æ•°: ${tests.length}
æˆåŠŸ: ${testResults.filter(r => r.includes('âœ…')).length}
å¤±è´¥: ${testResults.filter(r => r.includes('âŒ')).length}

å®Œæˆæ—¶é—´: ${new Date().toLocaleString()}`, 'fullTestResult');
                    return;
                }

                const test = tests[currentTest];
                showResult(`æ­£åœ¨è¿è¡Œ: ${test.name}...\n${testResults.join('\n')}`, 'fullTestResult');
                
                test.func((result) => {
                    testResults.push(`${currentTest + 1}. ${test.name}: ${result}`);
                    currentTest++;
                    setTimeout(runNextTest, 1000);
                });
            }

            runNextTest();
        }

        // æµ‹è¯•ç”¨çš„å…·ä½“å‡½æ•°
        function runCompressTest(callback) {
            plus.zip.compress('_www/', '_doc/full_test.zip', 
                () => callback('âœ… æˆåŠŸ'), 
                (error) => callback(`âŒ å¤±è´¥: ${error.message}`)
            );
        }

        function runDecompressTest(callback) {
            plus.zip.decompress('_doc/full_test.zip', '_doc/full_test_extracted/', 
                () => callback('âœ… æˆåŠŸ'), 
                (error) => callback(`âŒ å¤±è´¥: ${error.message}`)
            );
        }

        function runImageTest(callback) {
            plus.zip.compressImage({
                src: '_www/test_image.jpg',
                dst: '_doc/full_test_image.jpg',
                quality: 80,
                overwrite: true
            }, 
                () => callback('âœ… æˆåŠŸ'), 
                (error) => callback(`âŒ å¤±è´¥: ${error.message}`)
            );
        }

        function runVideoTest(callback) {
            plus.zip.compressVideo({
                src: '_www/test_video.mp4',
                quality: 'medium'
            }, 
                () => callback('âœ… æˆåŠŸ'), 
                (error) => callback(`âŒ å¤±è´¥: ${error.message}`)
            );
        }

        // åˆ›å»ºæµ‹è¯•æ–‡ä»¶
        function createTestFiles() {
            showLoading('createFilesLoading', true);
            showResult('æ­£åœ¨åˆ›å»ºæµ‹è¯•æ–‡ä»¶...', 'createFilesResult');

            // è¿™é‡Œæˆ‘ä»¬æ¨¡æ‹Ÿåˆ›å»ºæµ‹è¯•æ–‡ä»¶ï¼Œå®é™…åº”è¯¥é€šè¿‡plus.ioæˆ–å…¶ä»–æ–¹å¼
            // ç”±äºè¿™æ˜¯demoï¼Œæˆ‘ä»¬å…ˆæç¤ºç”¨æˆ·æ‰‹åŠ¨åˆ›å»º
            setTimeout(() => {
                showLoading('createFilesLoading', false);
                showResult(`ğŸ“ æµ‹è¯•æ–‡ä»¶åˆ›å»ºè¯´æ˜ï¼š

ç”±äºå½“å‰demoç¯å¢ƒé™åˆ¶ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼å‡†å¤‡æµ‹è¯•æ–‡ä»¶ï¼š

1. åœ¨è®¾å¤‡æ–‡æ¡£ç›®å½•åˆ›å»ºæµ‹è¯•æ–‡ä»¶
2. å°†éœ€è¦å‹ç¼©çš„æ–‡ä»¶æ”¾å…¥ _doc/test/ ç›®å½•
3. å‡†å¤‡æµ‹è¯•å›¾ç‰‡æ”¾å…¥ _doc/test_image.jpg
4. å‡†å¤‡æµ‹è¯•è§†é¢‘æ”¾å…¥ _doc/test_video.mp4

è·¯å¾„è¯´æ˜ï¼š
- _doc/ = åº”ç”¨æ–‡æ¡£ç›®å½• (${navigator.userAgent.includes('Android') ? '/data/data/com.example.flutter_base/files/' : '~/Documents/'})
- _www/ = åº”ç”¨æ–‡æ¡£ç›®å½•/www/ 
- _downloads/ = åº”ç”¨æ–‡æ¡£ç›®å½•/downloads/

å»ºè®®åˆ›å»ºçš„æµ‹è¯•æ–‡ä»¶ï¼š
- _doc/test/file1.txt
- _doc/test/file2.txt  
- _doc/test/subdirectory/file3.txt
- _doc/test_image.jpg
- _doc/test_video.mp4

åˆ›å»ºå®Œæˆåå³å¯è¿›è¡Œå‹ç¼©æµ‹è¯•ï¼`, 'createFilesResult');
            }, 1000);
        }

        // å¦‚æœé¡µé¢å·²ç»åŠ è½½å®Œæˆä½† plus è¿˜æ²¡å‡†å¤‡å¥½ï¼Œæ˜¾ç¤ºç­‰å¾…ä¿¡æ¯
        if (typeof plus === 'undefined') {
            console.log('ç­‰å¾… Plus å¯¹è±¡åˆå§‹åŒ–...');
        }
    </script>
</body>
</html>